(()=>{"use strict";const e="http://notesapp.ddns.net",t=`${e}/api/notes`,n=`${e}/api/account`,o=3e5;class i{constructor(e,t,n,o=!1){this.id=e,this.text=t,this.order=n,this.is_checked=o}}class r{constructor(e,t,n,o,i,r="normal",a=[],s=null){this.id=e,this.title=t,this.content=n,this.type=o,this.color=i,this.status=r,this.list_items=a,this.image=s}}async function a(){const e=localStorage.getItem("access");if(!e||"undefined"===e)return null;const t=localStorage.getItem("token_expiry"),i=(new Date).getTime();return t&&i<t?e:await async function(){const e=await fetch(`${n}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:localStorage.getItem("refresh")})});if(!e.ok)throw localStorage.removeItem("access"),localStorage.removeItem("refresh"),localStorage.removeItem("token_expiry"),new Error("Failed to refresh token");const t=await e.json(),i=t.access,r=t.refresh,a=(new Date).getTime()+o;return localStorage.setItem("token_expiry",a),localStorage.setItem("refresh",r),localStorage.setItem("access",i),i}()}async function s(e,n){let o=`${t}/notes/`;o+="?",Object.keys(e).forEach((t=>{e[t].forEach((e=>{o+=`${t}=${e}&`}))}));const i=o.slice(0,-1),r=await fetch(i,{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error("Failed to get notes from server");const a=await r.json();return console.log("DATA",a),a.reverse()}async function c(e,n){console.log("deleteNoteOnServer");let o=await fetch(`${t}/notes/${e}/`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Failed to delete note on server");return o}async function l(e,n,o){console.log("updateNoteOnServer");const i=new FormData;n.hasOwnProperty("color")&&i.append("color",n.color),n.hasOwnProperty("content")&&i.append("content",n.content),n.hasOwnProperty("status")&&i.append("status",n.status),n.hasOwnProperty("title")&&i.append("title",n.title),n.hasOwnProperty("image")&&n.image&&i.append("image",n.image),n.hasOwnProperty("list_items")&&n.list_items&&n.list_items.forEach(((e,t)=>{i.append(`list_items[${t}]id`,e.id),i.append(`list_items[${t}]text`,e.text),i.append(`list_items[${t}]order`,e.order),i.append(`list_items[${t}]is_checked`,e.is_checked)}));const r=await fetch(`${t}/notes/${e}/`,{method:"PATCH",body:i,headers:{Authorization:`Bearer ${o}`}});if(!r.ok)throw new Error("Failed to update note on server");return r.json()}async function d(e,t,n){return l(e,{status:t?"archived":"normal"},n)}async function u(e,t){return l(e,{status:"deleted"},t)}async function p(e,t){return l(e,{status:"archived"},t)}async function h(e,n){const o=encodeURIComponent(e),i=`${t}/notes/?search=${o}`,r=await fetch(i,{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error("Failed to search notes on server");return await r.json()}async function y(e,t){const i=await fetch(`${n}/token/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!i.ok)throw(await i.json()).detail;const r=await i.json();if(r.access){const e=(new Date).getTime()+o;localStorage.setItem("token_expiry",e),localStorage.setItem("refresh",r.refresh),localStorage.setItem("access",r.access)}return r}function f(){const e=$e("div","signup-window window");e.style.width="480px";const t=$e("h2","window-header","Sign Up / Sign In"),n=$e("div","signup-container");n.style.marginTop="12px";const o=function(){const e=$e("form","signup-form"),t=function(){const e=$e("div","signup-input-container"),t=m("email-input","Email","email-error");return e.appendChild(t),e}(),n=function(){const e=$e("div","signup-submit-button-container"),t=$e("button","signup-submit-button","Next");return t.addEventListener("click",V),e.appendChild(t),e}();return e.appendChild(t),e.appendChild(n),e}(),i=function(){const e=$e("aside","third-party-auth"),t=$e("div","separator","or"),n=function(){const e=$e("button","google-login-button");e.addEventListener("click",(e=>{e.preventDefault()}));const t=$e("span","google-icon");return e.appendChild(t),e.appendChild(document.createTextNode("Continue with Google")),e}();return e.appendChild(t),e.appendChild(n),e}();return n.appendChild(o),n.appendChild(i),e.appendChild(t),e.appendChild(n),e}function m(e,t,n){const o=$e("div","input-container"),i=$e("input",`${e} signup-input`);i.placeholder=t;const r=$e("div",`${n} error-message`);return o.appendChild(r),o.appendChild(i),o}async function g(){try{return await a()||(function(){Me.overlay.style.display="block",document.body.style.overflowY="hidden";const e=f();document.body.appendChild(e)}(),null)}catch(e){console.log("Error: ",e)}}async function b(){try{return await a()||(Me.notesContainer.innerHTML="",Me.notesContainer.style.removeProperty("height"),Me.messageNoContent.style.display="flex",null)}catch(e){console.log("Error: ",e)}}function C(e,t=!1,n="",o=null){const i=$e("div","checkbox");o&&i.setAttribute("data-listitem-id",o),e&&i.classList.add("empty-checkbox");const r=function(e,t=!1){const n=$e("div","checkbox-icon"),o=function(e,t){const n=document.createElement("i");return n.className=e?"fa-solid fa-plus new-checkbox-icon":t?"fa-regular fa-square-check check-icon":"fa-regular fa-square check-icon",n}(e,t);return e||"#trash"===window.location.hash?e||(o.style.color="var(--header-button-icon)",o.style.cursor="not-allowed"):n.addEventListener("click",de),n.appendChild(o),n}(e,t),a=function(e,t=!1,n=""){const o=$e("div","checkbox-input"),i=function(e){const t=$e("div","checkbox-text-empty","List item");return e&&(t.style.display="block"),t}(e),r=function(e,t,n){const o=$e("div","checkbox-text");return o.contentEditable="true",o.tabIndex="0",o.spellcheck="true",o.textContent=n,e?(o.addEventListener("input",ye),o.addEventListener("keydown",Q)):(o.addEventListener("keydown",le),o.addEventListener("keydown",he)),t&&(o.style.textDecoration="line-through",o.style.opacity="0.7"),o}(e,t,n);if(o.appendChild(i),o.appendChild(r),!e){const e=function(){const e=$e("div","checkbox-delete-button");e.role="button",e.tabIndex="0",e.title="Delete";const t=$e("i","fa-solid fa-xmark");return e.appendChild(t),e.addEventListener("click",pe),e}();o.appendChild(e)}return o}(e,t,n);return i.appendChild(r),i.appendChild(a),i}function x(e,t,n){let o=e;const i="down"===n?1:-1;for(;o;){if(o.classList.contains("checkbox")){const e=o.style.transform.match(/translateY\((-?\d+)px\)/);let n=0;e&&(n=parseFloat(e[1])),o.style.transform=`translateY(${n+t*i}px)`}o=o.nextElementSibling}}function v(e,t=32){x(e,t,"down")}function w(e,t){console.log("createImagesContainer"),t.innerHTML="",t.style.display="block",t.style.paddingTop=e.naturalHeight/e.naturalWidth*100+"%";const n=$e("div","img-container");e.className="img";const o=function(e){const t=$e("div","img-delete-button img-delete");t.role="button",t.tabIndex="0",t.title="Remove image",t.addEventListener("click",(()=>E(e)));const n=$e("i","fa-solid fa-trash img-delete");return t.appendChild(n),t}(t);n.appendChild(e),n.appendChild(o),t.appendChild(n)}function E(e){e.innerHTML="",e.style.display="none",e.style.removeProperty("padding-top")}function S(e){console.log("initImageFileInput");const t=$e("input","file-input");t.type="file",t.accept="image/png, image/jpeg",document.body.appendChild(t),t.addEventListener("change",(t=>{!function(e,t){const n=e.target.files[0];if(!n)return void alert("No file selected");if(n.size>10485760)return void alert("File is too large. Maximum allowed size is 10MB.");const o=new Image;o.onload=function(){this.width*this.height>26214400?alert("Image resolution is too high. Maximum allowed resolution is 25 megapixels."):(w(this,t),q())},o.src=URL.createObjectURL(n)}(t,e)})),t.click()}function k(e,t){const n=window.innerWidth,o=window.innerHeight,i=t.getBoundingClientRect(),r=e.getBoundingClientRect();let a=i.left+window.scrollX+20;a+r.width>n&&(a=n-r.width-20);let s=i.bottom+window.scrollY;s+r.height>o&&(s=o-r.height-10),e.style.top=`${s}px`,e.style.left=`${a}px`}function L(){const e=document.querySelectorAll('.box-note i[title="Unpin note"]').length>0,t=document.querySelectorAll('.box-note i[title="Pin note"]').length>0;Me.pinnedText.style.visibility=e?"visible":"hidden",Me.othersText.style.visibility=t&&e?"visible":"hidden"}function q(){const e=Array.from(Me.notesCatalog.querySelectorAll(".box-note")),t=Me.notesContainer.clientWidth,n=e.length>0?e[0].offsetWidth:240,o=16,i=new Array(Math.floor(t/(n+o))).fill(0);let r=0;if(e.filter((e=>{const t=e.querySelector(".pin-icon");return t&&"Unpin note"===t.title})).forEach((e=>{const a=e.offsetHeight;let s=i[r/(n+o)]||Me.pinnedText.offsetHeight+o+8;e.style.transform=`translate(${r}px, ${s}px)`,i[r/(n+o)]=s+a+o,r+=n+o,r+n+o>t&&(r=0)})),!(e.filter((e=>{const t=e.querySelector(".pin-icon");return!t||"Unpin note"!==t.title})).length>0)){const e=Math.max(...i);return void(Me.notesContainer.style.height=`${e+20}px`)}{const e=Math.max(...i);Me.othersText.style.transform=`translate(0px, ${e}px)`,i.fill(e+Me.othersText.offsetHeight+o+8)}r=0,e.filter((e=>{const t=e.querySelector(".pin-icon");return!t||"Unpin note"!==t.title})).forEach((e=>{const a=e.offsetHeight;let s=i[r/(n+o)];e.style.transform=`translate(${r}px, ${s}px)`,i[r/(n+o)]=s+a+o,r+=n+o,r+n+o>t&&(r=0)}));const a=Math.max(...i);Me.notesContainer.style.height=`${a+20}px`,console.log("end position notes")}function N(){const e=window.innerWidth-Ie.offsetMenuWidth;return e<=632?.96*e:632}function A(){const e=Me.noteEditContainer.querySelector(".box-note");if(e){const t=window.innerWidth;e.style.width=t>=715?"600px":"85vw"}}function T(){Ie.isOneNoteInRow=!0;const e=N();Array.from(document.querySelectorAll(".box-note")).forEach((t=>{t.style.width=e-32+"px"})),Me.noteCreate.style.width=e-32+"px",Me.notesCatalog.style.width=`${e}px`,q()}function I(){const e=window.innerWidth-Ie.offsetMenuWidth;let t=Math.floor((e-16)/256),n=256*t+16;"list"===localStorage.getItem("displayMode")||1===t||2===t&&e===n?T():(Ie.isOneNoteInRow=!1,e===n&&(t--,n=256*t+16),Me.noteCreate.style.width=N()-32+"px",Me.notesCatalog.style.width=`${n}px`,Array.from(Me.notesCatalog.querySelectorAll(".box-note")).forEach((e=>{e.style.width="240px"})),q())}function M(e){console.log("addNoteToList"),Me.messageNoContent.style.display="none";const t=function(e,t){const n=$e("div","box-note");n.setAttribute("data-selected","false"),n.setAttribute("data-id",t),n.setAttribute("data-color",e||"none"),n.classList.add(e||"none");const o="list"===localStorage.getItem("displayMode")||Ie.isOneNoteInRow?N()-32:240;return n.style.width=`${o}px`,n}(e.color,e.id),n=Be("fa-solid fa-circle-check select-note-icon","Select note",ne),o=$e("div","note"),i=function(e){const t=$e("div","text-and-title-note");if(t.addEventListener("click",ce),"#home"===window.location.hash){const n=Be("fa-solid fa-thumbtack pin-icon","pinned"===e.status?"Unpin note":"Pin note",se);"pinned"===e.status&&(n.style.color="var(--dim-button-hover-color)"),t.appendChild(n)}const n=$e("div","images-container");(async function(e,t){if(t)try{let n=await g();if(!n)return;const o=await async function(e,t){const n=await fetch(e,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Failed to fetch image");const o=await n.blob();return URL.createObjectURL(o)}(t,n);!async function(e,t){t&&new Promise(((n,o)=>{const i=new Image;i.onload=function(){w(i,e),e.querySelector(".img-delete-button").style.display="none",q(),n(i)},i.onerror=function(){o(new Error(`Failed to load image: ${t}`))},i.src=t}))}(e,o)}catch(e){console.error("Error loading image:",e)}})(n,e.image),t.appendChild(n);const o=$e("div","note-title-text",e.title);o.style.display=e.title&&""!==e.title?"block":"none",t.appendChild(o);const i=$e("div","note-text",e.content);i.style.display=e.content&&""!==e.content?"block":"none",t.appendChild(i);const r=$e("div","checkboxes-container");return function(e,t){if("list"!==t.type)return;var n,o;o=32*t.list_items.length+"px",(n=e).style.height=o,n.style.paddingTop="10px",n.style.display="block",t.list_items.forEach((t=>{const n=C(!1,t.is_checked,t.text,t.id);e.appendChild(n)})),e.appendChild(C(!0)),function(e,t=32){let n=e,o=0;for(;n;){if(n.classList.contains("checkbox")){const e=t*o;n.style.transform=`translateY(${e}px)`,o++}n=n.nextElementSibling}}(e.querySelector(".checkbox")),e.querySelector(".empty-checkbox").style.display="none",e.querySelectorAll(".checkbox-delete-button").forEach((e=>e.style.display="none")),function(e){e.forEach((e=>{e.contentEditable="false",e.style.cursor="default"}))}(e.querySelectorAll(".checkbox-text"))}(r,e),t.appendChild(r),t}(e),r=function(e){const t=$e("div","note-toolbar"),n=document.createElement("div");n.style.display="flex";const o=window.location.hash;if(["#home","#archive","#search"].includes(o)){!function(e,t,n){e.appendChild(Be("fas fa-image","Add image",(()=>{S(t.querySelector(".images-container"))}))),e.appendChild(Be("fa-solid fa-palette","Change background color",te)),"#archive"===n?e.appendChild(Be("fa-solid fa-box-open","Unarchive",ie)):e.appendChild(Be("fa-solid fa-box","Archive",ie))}(n,e,o),t.appendChild(n);const i=function(){const e=$e("button","delete-button");e.addEventListener("click",oe);const t=Be("fa-solid fa-xmark","Delete");return e.appendChild(t),e}();t.appendChild(i)}else"#trash"===o&&(function(e){e.appendChild(Be("fa-solid fa-trash","Delete forever",ae)),e.appendChild(Be("fa-solid fa-trash-arrow-up","Restore",re))}(n),t.appendChild(n));return t}(t);o.appendChild(i),o.appendChild(r),t.appendChild(n),t.appendChild(o),Me.notesContainer.insertBefore(t,Me.notesContainer.firstChild),function(e,t){const n=function(e,t){return!(e.title&&""!==e.title||e.content&&""!==e.content||!(t.childElementCount<2)||e.image)}(t,e.querySelector(".checkboxes-container"));let o=e.querySelector(".empty-note");n&&!o?(o=$e("div","empty-note","Empty note"),o.addEventListener("click",ce),e.querySelector(".note").appendChild(o)):!n&&o&&e.querySelector(".note").removeChild(o)}(t,e)}function $(){Me.messageNoContent.style.display="flex","#trash"===window.location.hash&&(Me.btnEmptyTrash.style.display="none")}function B(e){Me.notesContainer.removeChild(e),L(),q(),0===Me.notesContainer.querySelectorAll(".box-note").length&&$()}function P(e){console.log("fillNotesContainer",e),e.map((e=>{let t;if("list"===e.type){const n=e.list_items.map((e=>new i(e.id,e.text,e.order,e.is_checked)));t=new r(e.id,e.title,null,e.type,e.color,e.status,n,e.image)}else t=new r(e.id,e.title,e.content,e.type,e.color,e.status,e.list_items,e.image);M(t)})),L(),q(),0===e.length?Me.messageNoContent.style.display="flex":"#trash"===window.location.hash&&(Me.btnEmptyTrash.style.display="block")}async function _(e,t){let n=await g();if(!n)return;D(t);const o=e.getAttribute("data-id"),i={status:"Unpin note"===t.title?"pinned":"normal"};try{l(o,i,n)}catch(e){console.log("Error: ",e)}Me.notesContainer.insertBefore(e,Me.notesContainer.firstChild)}function O(e,t){const n=$e("div",e);return n.style.display="block",n.contentEditable="#trash"===window.location.hash?"false":"true",n.role="textbox",n.tabIndex="0",n.spellcheck="true",n.addEventListener("input",t),n}function H(e,t,n){""===e.textContent.trim()?t.style.display="block":(t.style.display="none",n.innerHTML=e.innerHTML,e.textContent="")}function j(){document.body.style.removeProperty("overflow-y"),Me.noteEditContainer.style.display="none",Me.noteEditContainer.innerHTML="",Me.overlay.style.display="none",Ie.currentNote=null}function D(e){"Pin note"===e.title?(e.title="Unpin note",e.style.color="var(--dim-button-hover-color)"):(e.title="Pin note",e.style.removeProperty("color"))}function F(){Me.userAccount.innerHTML=""}function U(){Me.userAccount.style.visibility="hidden",Me.userAccount.style.height="0px",Me.userAccount.style.removeProperty("min-height")}const R=["none","coral","peach","sand","sage","fog","storm","dusk"];function z(e,t="no-select",n=!1){console.log("createColorToolbar",t);const o=document.querySelector(".change-background");o&&o.remove();const i=$e("div","change-background","",{tabindex:"0"}),r=function(e,t){const n=$e("div","change-background-color","",{tabindex:"0",role:"listbox"});return R.forEach((o=>{const i=function(e,t){const n=$e("div",`color-option ${e}`,"",{role:"option"}),o=$e("i","fa-solid fa-circle-check select-color-icon"),i=$e("i","fa-solid fa-droplet-slash no-color-icon");return"none"===e&&n.appendChild(i),o.style.display="none",n.appendChild(o),t===e&&(n.classList.add("chosen"),n.querySelector(".select-color-icon").style.display="inline-block"),n}(o,e);i.addEventListener("click",(e=>function(e,t=null){const n=e.target.closest(".color-option");var o;o=n,document.querySelectorAll(".color-option").forEach((e=>{e.classList.remove("chosen"),e.querySelector(".select-color-icon").style.display="none"})),o.classList.add("chosen"),o.querySelector(".select-color-icon").style.display="inline-block",async function(e,t){e.forEach((async e=>{R.forEach((t=>e.classList.remove(t))),e.classList.add(t),e.setAttribute("data-color",t);const n=e.getAttribute("data-id");if(n){const e={color:t};let o=await g();if(!o)return;try{l(n,e,o)}catch(e){console.log("Error: ",e)}}}))}(t?[t]:Ie.selectedNotes,n.className.split(" ")[1]),e.stopPropagation()}(e,t))),n.appendChild(i)})),n}(t,n?null:e.target.closest(".box-note, #note-form"));i.appendChild(r),document.body.appendChild(i),k(i,e.target),e.stopPropagation()}function W(){window.addEventListener("hashchange",De),window.addEventListener("scroll",(function(){const e=document.querySelector("header");window.scrollY>0?e.classList.add("has-shadow"):e.classList.remove("has-shadow")})),window.addEventListener("resize",(e=>{A(),I();const t=document.querySelector(".setting-menu");if(t){const e=window.innerWidth,n=Me.btnSettings.getBoundingClientRect(),o=t.getBoundingClientRect();let i=n.left+window.scrollX;i+o.width>e&&(i=e-o.width-20),t.style.top=`${n.bottom+window.scrollY}px`,t.style.left=`${i}px`}})),window.addEventListener("load",(e=>{A(),window.innerWidth>=610?I():T()})),document.addEventListener("click",(e=>{!function(e){!e.target.closest("#note-form")&&Ie.isNoteInputUnfolded&&(be(),He())}(e),function(e){const t=document.querySelector(".change-background");t&&!t.contains(e.target)&&t.remove()}(e),function(e){Me.userAccount.contains(e.target)||Me.btnLogin.contains(e.target)||U()}(e),function(e){const t=e.target.closest(".select-note-icon");Me.headerSelection.contains(e.target)||t||(Ae(),Ie.selectedCount=0)}(e),function(e){const t=document.querySelector(".setting-menu");Ie.isSettingMenuOpen&&!Me.btnSettings.contains(e.target)&&(Ie.isSettingMenuOpen=!1,t.style.display="none",t.tabIndex="-1")}(e)})),Me.btnMenuArchive.addEventListener("click",(()=>{window.location.hash="archive"})),Me.btnMenuTrash.addEventListener("click",(()=>{window.location.hash="trash"})),Me.btnMenuNotes.addEventListener("click",(()=>{window.location.hash="home"})),Me.inputNoteCreate.addEventListener("focus",(()=>{Ie.isNoteInputUnfolded||Oe()})),Me.inputNoteCreate.addEventListener("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})),Me.inputTitleCreate.addEventListener("keydown",(function(e){"Enter"===e.key&&(e.preventDefault(),Me.inputNoteCreate.focus())})),Me.inputSearch.addEventListener("focus",(e=>{Me.btnClearSearch.style.visibility="visible",window.location.hash="search"})),Me.inputSearch.addEventListener("keydown",(async e=>{if("Enter"===e.key){e.preventDefault();const t=Me.inputSearch.value.trim();if(""!==t){let e=await g();if(!e)return;Me.notesContainer.innerHTML="",Me.notesContainer.style.removeProperty("height"),Me.noteCreate.style.display="none",Me.notesContainer.appendChild(Me.pinnedText),Me.notesContainer.appendChild(Me.othersText);try{P(await h(t,e))}catch(e){console.log("Error: ",e)}}}})),Me.btnClearSearch.addEventListener("click",(function(e){e.preventDefault(),""!==Me.inputSearch.value.trim()?(Me.inputSearch.value="",Me.inputSearch.focus()):(Me.btnClearSearch.style.visibility="hidden",window.location.hash="home",Me.searchContainer.style.removeProperty("display"),Me.formSearch.style.removeProperty("background-color"))})),Me.btnClearSelection.addEventListener("click",(()=>{Ae(),Ie.selectedCount=0})),Me.btnMenuToggle.addEventListener("click",(()=>{window.innerWidth>=600&&(Ie.offsetMenuWidth=Ie.isMenuOpen?80:280,"list"===localStorage.getItem("displayMode")?T():I()),Me.sidebarNav.classList.toggle("open"),Me.sideBar.classList.toggle("open"),Ie.isMenuOpen=!Ie.isMenuOpen})),Me.btnViewToggle.addEventListener("click",(()=>{"list"===localStorage.getItem("displayMode")?(Me.btnViewToggle.querySelector("i").className="fa-solid fa-table-list fa-lg",Me.btnViewToggle.title="List view",localStorage.setItem("displayMode","grid"),I()):(Me.btnViewToggle.querySelector("i").className="fa-solid fa-table fa-lg",Me.btnViewToggle.title="Grid view",localStorage.setItem("displayMode","list"),T())})),Me.overlay.addEventListener("click",(e=>{Ie.isNoteModificationMode&&async function(){console.log("submitNoteModifications"),Ie.isNoteModificationMode=!1;const e=Me.noteEditContainer.querySelector(".title-text-input"),t=Me.noteEditContainer.querySelector(".note-text-input"),n=Me.noteEditContainer.querySelector(".box-note"),o=Me.noteEditContainer.querySelector(".checkboxes-container"),r=Me.noteEditContainer.querySelector(".images-container"),a=Ie.currentNote.closest(".text-and-title-note"),s=Ie.currentNote.closest(".box-note"),c=a.querySelector(".note-text"),d=Ie.currentNote.querySelector(".checkboxes-container"),u=Ie.currentNote.querySelector(".images-container"),p=Ie.currentNote.closest(".box-note").getAttribute("data-id"),h=(f=o,Array.from(f.querySelectorAll(".checkbox-text")).slice(0,-1).map(((e,t)=>{const n=e.closest(".checkbox").getAttribute("data-listitem-id"),o=e.closest(".checkbox").querySelector(".check-icon").classList.contains("fa-square-check");return new i(n,e.textContent,t,o)}))),y=await Ce(r);var f;let m={title:e.textContent,content:t.innerText,list_items:h,image:y};try{let e=await g();if(!e)return;!function(e,t,n){console.log("Success:",e),e.list_items.forEach(((e,o)=>{t[o].id||n.querySelector(`.checkbox:nth-child(${o+1})`).setAttribute("data-listitem-id",e.id)}))}(await l(p,m,e),h,o),function(e,t){if("#trash"!==window.location.hash)if(""!==e.innerHTML&&e.childElementCount>1){t.innerHTML="",Array.from(e.cloneNode(!0).children).forEach((e=>{t.appendChild(e)}));const n=parseFloat(e.style.height)||32;t.style.height=n-32+"px",t.style.paddingTop="10px",t.querySelector(".empty-checkbox").style.display="none",t.querySelectorAll(".checkbox-icon .check-icon").forEach((e=>{e.addEventListener("click",de)})),t.querySelectorAll(".checkbox-delete-button").forEach((e=>{e.style.display="none"})),t.querySelectorAll(".checkbox-text").forEach((e=>{e.contentEditable="false",e.style.cursor="default"}))}else E(t),t.style.height="32px"}(o,d),function(e,t){if(""!==e.innerHTML){t.innerHTML="",Array.from(e.cloneNode(!0).children).forEach((e=>{t.appendChild(e)}));const n=parseFloat(e.style.paddingTop);t.style.paddingTop=`${n}%`,t.style.display=e.style.display,t.querySelector(".img-delete-button").style.display="none"}else E(t)}(r,u),L(),q()}catch(e){console.error("Error:",e)}var b,C,x,v;s.style.opacity="1",function(e,t){const n=t.querySelector(".note-title-text");""!==e.textContent?(n.style.display="block",n.textContent=e.textContent):(n.style.display="none",n.textContent="")}(e,a),x=t,(v=c).innerText=x.innerText,v.style.display=""===x.textContent?"none":"block",function(e,t,n,o,i,r){if(""!==e.textContent||""!==t.textContent||""!==n.innerHTML&&1!==n.childElementCount||""!==o.innerHTML)r.querySelector(".empty-note")&&r.querySelector(".note").removeChild(r.querySelector(".empty-note"));else if(!r.querySelector(".empty-note")){const e=$e("div","empty-note","Empty note");r.querySelector(".note").appendChild(e),e.addEventListener("click",ce),i.style.display="none"}}(t,e,o,r,d,s),C=n,(b=s).classList.remove(b.getAttribute("data-color")),b.classList.add(C.getAttribute("data-color")),b.setAttribute("data-color",C.getAttribute("data-color")),Me.noteEditContainer.style.display="none",Me.noteEditContainer.innerHTML="",document.body.style.removeProperty("overflow-y"),Ie.currentNote.style.removeProperty("overflow-y"),Ie.currentNote.style.removeProperty("max-height"),Ie.currentNote=null}(),Ie.isSettingWindowOpen&&(document.querySelector(".settings-window").style.display="none",Ie.isSettingWindowOpen=!1);const t=document.querySelector(".signup-window");t&&document.body.removeChild(t),Me.overlay.style.display="none",document.body.style.removeProperty("overflow-y"),e.stopPropagation()})),Me.btnEmptyTrash.addEventListener("click",(async()=>{try{let e=await g();if(!e)return;const t=Array.from(Me.notesContainer.querySelectorAll(".box-note"));await Promise.all(t.map((async t=>{const n=t.getAttribute("data-id");await c(n,e),B(t)}))),Me.notesContainer.style.removeProperty("height")}catch(e){console.log("Error: ",e)}})),Me.btnImageCreate.addEventListener("click",(()=>{S(Me.imagesContainer),Ie.isNoteInputUnfolded||Oe()})),Me.btnListCreate.addEventListener("click",(()=>{Ie.isListItemsAddMode||(Ie.isListItemsAddMode=!0,Oe(),Me.inputNoteCreate.style.display="none",Me.checkboxesContainer.style.display="block",Me.checkboxesContainer.style.height="32px",Me.checkboxesContainer.appendChild(C(!0)),Me.formNoteCreate.insertBefore(Me.checkboxesContainer,Me.inputGroupCreate))})),Me.btnLogin.addEventListener("click",(e=>{e.preventDefault(),Me.userAccount.style.visibility="visible",Me.userAccount.style.height="365px",Me.userAccount.style.minHeight="210px",F(),async function(){const e=$e("div","account-container"),t=function(){const e=$e("button","btn-close-account");e.role="button",e.addEventListener("click",U);const t=$e("i","fa-solid fa-xmark fa-xl");return e.appendChild(t),e}(),o=$e("div","account-content");let i=!1,r=null;try{const e=await a();i=!!e,r=i?await async function(e){const t=await fetch(`${n}/user/`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to get user info");return t.json()}(e):null}catch(e){console.log("Error: ",e)}r&&o.appendChild(function(e){const t=$e("div","email-container"),n=$e("div","email-text",e);return t.appendChild(n),t}(r.email));const s=function(e,t){const n=$e("i","fa-solid fa-circle-user"),o=$e("div","account-image");o.appendChild(n);const i=$e("div","account-nickname",function(e){if(e){let t=e.first_name;return""!==e.last_name?t+=` ${e.last_name}!`:t+="!",`Hi, ${t}`}return"Welcome!"}(t)),r=$e("div","account-info");if(r.appendChild(o),r.appendChild(i),!e){const e=$e("div","account-description","Please sign in or create an account to save your notes.");r.appendChild(e)}return r}(i,r),c=function(e){const t=$e("div","account-manage");if(e){const e=function(){const e=$e("div","btn-edit-account","Manage your account");return e.role="button",e.addEventListener("click",Ne),e}(),n=function(){const e=$e("i","fa-solid fa-arrow-right-from-bracket"),t=$e("div","signout-icon");t.appendChild(e);const n=$e("div","signout-text","Sign Out"),o=$e("div","btn-signout");return o.role="button",o.addEventListener("click",ge),o.appendChild(t),o.appendChild(n),o}();t.appendChild(e),t.appendChild(n)}else{const e=function(){const e=$e("div","btn-signup","Sign Up / Sign In");return e.role="button",e.addEventListener("click",G),e}();t.style.display="flex",t.style.justifyContent="center",t.style.marginTop="25px",t.appendChild(e)}return t}(i),l=$e("div","account");l.appendChild(s),l.appendChild(c),o.appendChild(l),e.appendChild(t),e.appendChild(o),Me.userAccount.appendChild(e)}()})),Me.btnSettings.addEventListener("click",(()=>{if(Ie.isSettingMenuOpen)return;Ie.isSettingMenuOpen=!0;let e=document.querySelector(".setting-menu");e?function(e){e.style.removeProperty("display"),e.tabIndex="0"}(e):(e=function(){const e=$e("div","setting-menu");e.role="menu";const t=function(e,t){const n=$e("div","setting-menu-item");n.role="menuitem";const o=$e("div","setting-menu-item-text","Switch theme");return n.appendChild(o),n.addEventListener("click",t),n}(0,Y);return e.appendChild(t),e}(),document.body.appendChild(e)),k(e,Me.btnSettings)})),Me.btnEnterSearch.addEventListener("click",(async function(e){e.preventDefault(),window.innerWidth<795&&(Me.searchContainer.style.display="block",Me.formSearch.style.backgroundColor="var(--search-form-bc)");const t=Me.inputSearch.value.trim();if(""===t)document.activeElement!==Me.inputSearch&&Me.inputSearch.focus();else{try{if(!await g())return}catch(e){console.log("Error: ",e)}Me.notesContainer.innerHTML="",Me.notesContainer.style.removeProperty("height"),Me.noteCreate.style.display="none",Me.notesContainer.appendChild(Me.pinnedText),Me.notesContainer.appendChild(Me.othersText);try{P(await h(t,token))}catch(e){console.log("Error: ",e)}}})),Me.formNoteCreate.addEventListener("submit",(e=>{e.preventDefault(),be()})),Me.btnBackgroundCreate.addEventListener("click",te)}function Y(e){document.body.classList.toggle("dark-theme"),"light"===localStorage.getItem("theme")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light")}function G(e){F(),U(),Me.overlay.style.display="block",document.body.style.overflowY="hidden";const t=f();document.body.appendChild(t)}async function V(e){e.preventDefault();const t=e.target.closest(".signup-form").querySelector(".signup-input-container"),o=t.querySelector(".email-input"),i=t.closest(".signup-form").querySelector(".signup-submit-button");try{const e=await async function(e){const t=await fetch(`${n}/email/?email=${encodeURIComponent(e)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to check if email already exists");return t.json()}(o.value.trim());e.error?console.log("email error",e.error):e.exists?(function(e){const t=m("password-input","Password","password-error");e.appendChild(t)}(t),i.addEventListener("click",fe),i.removeEventListener("click",V)):(function(e){[{className:"password-input",placeholder:"Password",errorClass:"password-error"},{className:"confirm-input",placeholder:"Confirm password",errorClass:"confirm-error"},{className:"first-name-input",placeholder:"First name",errorClass:"first-name-error"},{className:"last-name-input",placeholder:"Last name (optional)",errorClass:"last-name-error"}].forEach((t=>{const n=m(t.className,t.placeholder,t.errorClass);e.appendChild(n)}))}(t),i.addEventListener("click",me),i.removeEventListener("click",V))}catch(e){console.error("Error:",e)}}function J(e){const t=e.target,n=e.target.closest(".note-title-text").querySelector(".title-placeholder");""===t.textContent.trim()?n.style.display="block":n.style.display="none"}function X(e){"Enter"===e.key&&(e.preventDefault(),e.target.closest(".note").querySelector(".note-text-input").focus())}function K(e){const t=e.target,n=e.target.closest(".note-text").querySelector(".text-placeholder");""===t.textContent.trim()?n.style.display="block":n.style.display="none"}function Q(e){"Enter"===e.key&&e.preventDefault()}function Z(e){e.target.parentNode.querySelector(".checkbox-delete-button").style.opacity="1"}function ee(e){e.target.parentNode.querySelector(".checkbox-delete-button").style.removeProperty("opacity")}function te(e){const t=e.target.closest(".box-note, #note-form");z(e,t.getAttribute("data-color")||"none",!1),e.stopPropagation()}function ne(e){const t=e.currentTarget,n=e.currentTarget.closest(".box-note"),o="true"===n.getAttribute("data-selected");var i;0===Ie.selectedCount&&(Me.headerSelection.style.display="flex",Me.headerSelection.style.opacity="1",Me.headerSelection.style.transform="translateY(0)"),o?(n.classList.remove("selected"),n.setAttribute("data-selected","false"),t.classList.remove("visible"),Ie.selectedCount--,function(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}(Ie.selectedNotes,n)):(n.classList.add("selected"),n.setAttribute("data-selected","true"),t.classList.add("visible"),Ie.selectedCount++,Ie.selectedNotes.push(n)),0===Ie.selectedCount&&Ae(),i=Ie.selectedCount,Me.textSelection.textContent=`${i} selected`}async function oe(e){const t=e.target.closest(".box-note"),n=t.getAttribute("data-id");try{let e=await g();if(!e)return;u(n,e)}catch(e){console.log("Error: ",e)}B(t)}async function ie(e){const t=e.target.closest(".box-note"),n=t.getAttribute("data-id"),o="Archive"===e.target.title;try{let e=await g();if(!e)return;await d(n,o,e)}catch(e){console.log("Error: ",e)}B(t)}async function re(e){const t=e.target.closest(".box-note"),n=t.getAttribute("data-id");try{let e=await g();if(!e)return;p(n,e)}catch(e){console.log("Error: ",e)}B(t)}async function ae(e){const t=e.target.closest(".box-note"),n=t.getAttribute("data-id");try{let e=await g();if(!e)return;await c(n,e)}catch(e){console.log("Error: ",e)}B(t)}async function se(e){const t=e.target.closest(".box-note");await _(t,e.target),L(),q()}function ce(e){if(e.target.classList.contains("pin-icon")||e.target.classList.contains("check-icon")||e.target.classList.contains("new-checkbox-icon")||e.target.classList.contains("img-delete"))return;Ie.isNoteModificationMode=!0,Ie.currentNote=Array.from(e.target.closest(".note").children).find((e=>e.classList.contains("text-and-title-note"))),Me.overlay.style.display="block",document.body.style.overflowY="hidden";const n=Ie.currentNote.closest(".box-note"),o=n.cloneNode(!0);o.style.transform="none",o.style.position="relative",o.style.margin="0",o.querySelector(".text-and-title-note").style.overflowY="auto",o.querySelector(".text-and-title-note").style.maxHeight="482px",n.style.opacity="0",function(e){const t=e.querySelector(".pin-icon");t&&t.classList.add("edit"),e.querySelector(".note-title-text").classList.add("edit"),e.querySelector(".note-text").classList.add("edit"),e.querySelector(".note-toolbar").classList.add("edit"),e.querySelector(".select-note-icon").style.display="none"}(o),function(e,n){console.log("setupNoteEditElements");const o=n.querySelector(".empty-note");o&&(o.style.display="none");const i=n.querySelector(".fa-image");i&&i.addEventListener("click",(()=>{S(n.querySelector(".images-container"))}));const r=n.querySelector(".fa-palette");r&&r.addEventListener("click",te);const a=n.querySelector(".delete-button");a&&a.addEventListener("click",(async()=>{let t=await g();if(!t)return;const n=e.getAttribute("data-id");try{u(n,t)}catch(e){console.log("Error: ",e)}B(e),j()}));const s=n.querySelector(".pin-icon");s&&s.addEventListener("click",(async()=>{D(s);const t=e.querySelector(".pin-icon");await _(e,t)}));const l=n.querySelector(".fa-box")||n.querySelector(".fa-box-open");l&&l.addEventListener("click",(async()=>{let t=await g();if(!t)return;const n=e.getAttribute("data-id"),o="Archive"===l.title;try{await d(n,o,t)}catch(e){console.log("Error: ",e)}B(e),j()}));const h=n.querySelector(".fa-trash:not(.img-delete)");h&&h.addEventListener("click",(async()=>{let t=await g();if(!t)return;const n=e.getAttribute("data-id");try{await c(n,t)}catch(e){console.log("Error: ",e)}B(e),j()}));const y=n.querySelector(".fa-trash-arrow-up");y&&y.addEventListener("click",(async()=>{let t=await g();if(!t)return;const n=e.getAttribute("data-id");try{p(n,t)}catch(e){console.log("Error: ",e)}B(e),j()})),function(e){console.log("setupTitleEditing");const t=e.querySelector(".note-title-text");var n;""===(n=t).textContent.trim()&&"#trash"===window.location.hash?n.style.display="none":n.style.display="block";const o=$e("div","title-placeholder","Title"),i=O("title-text-input",J);i.addEventListener("keydown",X),H(t,o,i),t.appendChild(o),t.appendChild(i)}(n),function(e){console.log("setupEditCheckboxes");const t=e.querySelector(".checkboxes-container");if(""!==t.innerHTML&&t.childElementCount>1){if("#trash"!==window.location.hash){const e=parseFloat(t.style.height)||32;t.style.height=`${e+32}px`,t.style.removeProperty("padding-top");const n=t.querySelector(".empty-checkbox");n.style.removeProperty("display"),t.querySelectorAll(".checkbox-icon .check-icon").forEach((e=>{e.addEventListener("click",ue)})),t.querySelectorAll(".checkbox-delete-button").forEach((e=>{e.style.removeProperty("display"),e.addEventListener("click",pe)})),t.querySelectorAll(".checkbox-text").forEach((e=>{e.addEventListener("keydown",he),e.contentEditable="true",e.style.removeProperty("cursor")})),n.addEventListener("input",ye),n.addEventListener("keydown",Q)}t.querySelectorAll(".checkbox:not(.empty-checkbox)").forEach((e=>{const t=e.querySelector(".checkbox-text");t.addEventListener("focus",Z),t.addEventListener("blur",ee),t.addEventListener("keydown",le)}))}}(n),function(e,n){console.log("setupEditImages");const o=n.querySelector(".images-container");if(""!==o.innerHTML){const n=o.querySelector(".img-delete-button");n.style.removeProperty("display"),n.addEventListener("click",(async()=>{E(o);let n=await g();if(!n)return;const i=e.getAttribute("data-id");try{!async function(e,n){if(console.log("deleteImage"),!(await fetch(`${t}/notes/${e}/image/`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}})).ok)throw new Error("Failed to delete image on server")}(i,n)}catch(e){console.log("Error: ",e)}}))}}(e,n),function(e){console.log("setupTextEditing");const t=e.querySelector(".note-text");var n,o;n=t,""!==(o=e.querySelector(".checkboxes-container")).innerHTML&&o.childElementCount>1||""===n.textContent.trim()&&"#trash"===window.location.hash?n.style.display="none":n.style.display="block";const i=$e("div","text-placeholder","Note"),r=O("note-text-input",K);H(t,i,r),t.appendChild(i),t.appendChild(r)}(n)}(n,o),Me.noteEditContainer.style.display="block",Me.noteEditContainer.appendChild(o),document.body.appendChild(Me.noteEditContainer),A()}function le(e){const t=e.target,n=t.closest(".checkbox");if("Enter"===e.key){e.preventDefault();const o=window.getSelection().getRangeAt(0).endOffset,i=o===t.textContent.length,r=n.nextElementSibling;if(r&&r.classList.contains("checkbox"))if(r.classList.contains("empty-checkbox")&&i)r.querySelector(".checkbox-text").focus();else{const e=function(e,t){const n=e.textContent.slice(t);return e.textContent=e.textContent.slice(0,t),n}(t,o);v(r,32),function(e,t){const n=C(!1);!function(e,t){const n=t.style.transform,o=parseFloat(n.match(/translateY\((-?\d+)px\)/)?.[1]||0);e.style.transform=`translateY(${o+32}px)`}(n,e);const o=e.parentNode,i=parseFloat(o.style.height)||32;return o.insertBefore(n,e.nextElementSibling),o.style.height=`${i+32}px`,n.querySelector(".checkbox-text").textContent=t,n}(n,e).querySelector(".checkbox-text").focus()}}}async function de(e){const n=ue(e),o=n.closest(".checkbox").getAttribute("data-listitem-id");if(o){const e={is_checked:n.classList.contains("fa-square-check")};try{let n=await g();if(!n)return;const i=await async function(e,n,o){const i=await fetch(`${t}/list-items/${e}/`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(n)});if(!i.ok)throw new Error("Failed to update checkbox on server");return i.json()}(o,e,n);console.log("Success:",i)}catch(e){console.error("Error:",e)}}}function ue(e){const t=e.target,n=t.closest(".checkbox").querySelector(".checkbox-text");return t.classList.contains("fa-square")?(t.classList.remove("fa-square"),t.classList.add("fa-square-check"),n.style.textDecoration="line-through",n.style.opacity="0.7"):(t.classList.remove("fa-square-check"),t.classList.add("fa-square"),n.style.removeProperty("text-decoration"),n.style.opacity="1"),t}async function pe(e){const t=e.target.closest(".checkbox"),n=parseFloat(t.parentNode.style.height)||32;t.parentNode.style.height=n-32+"px";const o=t.nextElementSibling,i=t.previousElementSibling;i?i.querySelector(".checkbox-text").focus():o.querySelector(".checkbox-text").focus(),t.parentNode.removeChild(t),function(e,t=32){x(e,t,"up")}(o,32)}function he(e){const t=e.target,n=t.closest(".checkboxes-container");"Backspace"===e.key&&""===t.textContent.trim()&&n.childElementCount>2&&pe(e)}function ye(e){const t=e.target,n=t.closest(".checkbox");if(t.textContent.trim().length>0){const e=C(!1,!1,t.textContent);e.style.transform=n.style.transform,function(e,t){const n=e.parentNode,o=parseFloat(n.style.height)||32;n.insertBefore(t,e),n.style.height=`${o+32}px`}(n,e),v(n),function(e){const t=e.querySelector(".checkbox-text");t.focus();const n=document.createRange(),o=window.getSelection();n.selectNodeContents(t),n.collapse(!1),o.removeAllRanges(),o.addRange(n)}(e),t.textContent=""}}async function fe(e){e.preventDefault();const t=e.target.closest(".signup-form").querySelector(".signup-input-container"),n=t.querySelector(".email-input"),o=t.querySelector(".password-input"),i=t.querySelector(".email-error");i.textContent="";try{await y(n.value.trim(),o.value.trim()),Me.overlay.click(),De()}catch(e){a=i,(r=e)&&(a.textContent=r)}var r,a}async function me(e){e.preventDefault();const t=e.target.closest(".signup-form").querySelector(".signup-input-container"),o=t.querySelector(".email-error"),i=t.querySelector(".password-error"),r=t.querySelector(".confirm-error"),a=t.querySelector(".first-name-error"),s=t.querySelector(".last-name-error");[o,i,r,a,s].forEach((e=>e.textContent=""));const c={email:t.querySelector(".email-input").value.trim(),password:t.querySelector(".password-input").value.trim(),password2:t.querySelector(".confirm-input").value.trim(),first_name:t.querySelector(".first-name-input").value.trim(),last_name:t.querySelector(".last-name-input").value.trim()};try{await async function(e){const t=await fetch(`${n}/register/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw(await t.json()).detail;return t.json()}(c),await y(c.email,c.password),Me.overlay.click(),De()}catch(e){d={emailError:o,passwordError:i,confirmError:r,firstNameError:a,lastNameError:s},(l=e)&&(l.email&&(d.emailError.textContent=l.email.join(" ")),l.password&&(d.passwordError.textContent=l.password.join(" ")),l.password2&&(d.confirmError.textContent=l.password2.join(" ")),l.first_name&&(d.firstNameError.textContent=l.first_name.join(" ")),l.last_name&&(d.lastNameError.textContent=l.last_name.join(" ")),l.detail&&(d.emailError.textContent=l.detail))}var l,d}function ge(e){localStorage.clear(),F(),U(),De(),Pe(),_e()}async function be(){console.log("submitNote");const e=Me.checkboxesContainer.childElementCount>1,n=""!==Me.inputNoteCreate.value.trim(),o=""!==Me.inputTitleCreate.value.trim(),r=""!==Me.imagesContainer.innerHTML;if(!(e||n||o||r))return;let a,s=await Ce(Me.imagesContainer);a=e?xe("list",Array.from(Me.checkboxesContainer.querySelectorAll(".checkbox-text")).slice(0,-1).map(((e,t)=>{const n=e.closest(".checkbox").querySelector(".check-icon").classList.contains("fa-square-check");return new i(null,e.textContent,t,n)})),s):xe("text",[],s);try{let e=await g();if(!e)return;const n=await async function(e,n){const o=new FormData;o.append("color",e.color),o.append("content",e.content),o.append("title",e.title),e.image&&o.append("image",e.image),e.list_items&&e.list_items.forEach(((e,t)=>{o.append(`list_items[${t}]text`,e.text),o.append(`list_items[${t}]order`,e.order),o.append(`list_items[${t}]is_checked`,e.is_checked)}));const i=await fetch(`${t}/notes/`,{method:"POST",body:o,headers:{Authorization:`Bearer ${n}`}});if(!i.ok)throw new Error("Failed to create note on server");return i.json()}(a,e);console.log("Success, note:",n),a.id=n.id,a.list_items=n.list_items,a.image=n.image,M(a),L(),q()}catch(e){console.error("Error:",e)}Me.checkboxesContainer.innerHTML="",Me.checkboxesContainer.removeAttribute("style"),Me.inputNoteCreate.style.removeProperty("display"),E(Me.imagesContainer),He()}async function Ce(e){const t=e.querySelector("img");if(!t)return null;if(t.src.startsWith("blob:")){const e=await fetch(t.src),n=await e.blob();return n&&0!==n.size?new File([n],"note-image.png",{type:n.type}):(console.error("Ошибка: blob пустой или не содержит данных"),null)}return null}function xe(e,t,n){return new r(null,Me.inputTitleCreate.value,Me.inputNoteCreate.value,e,Me.formNoteCreate.getAttribute("data-color"),"normal",t,n,null)}function ve(){Ie.selectedNotes.forEach((async e=>{const t=e.querySelector(".pin-icon"),n=t.closest(".box-note");await _(n,t)})),L(),q(),Ae()}function we(e){z(e,function(e){if(0===e.length)return null;const t=e[0].getAttribute("data-color");return e.every((e=>e.getAttribute("data-color")===t))?t:null}(Ie.selectedNotes)||"no-select",!0),e.stopPropagation()}function Ee(){Te({status:"archived"}),Ae()}function Se(){Te({status:"normal"}),Ae()}function ke(){Te({status:"deleted"}),Ae()}async function Le(){let e=await g();e&&(Ie.selectedNotes.forEach((async t=>{const n=t.closest(".box-note"),o=n.getAttribute("data-id");try{await c(o,e)}catch(e){console.log("Error: ",e)}B(n)})),Ae())}function qe(){Te({status:"normal"}),Ae()}async function Ne(){try{let e=await g();if(!e)return;const t=await async function(e){const t=await fetch(`${n}/user/`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({first_name:"Hello"})});if(!t.ok)throw new Error("Failed to update user info");return t.json()}(e);console.log("data",t)}catch(e){console.log("Error: ",e)}}function Ae(){Me.headerSelection.removeAttribute("style"),document.querySelectorAll(".box-note").forEach((e=>{e.classList.remove("selected"),e.setAttribute("data-selected","false")})),document.querySelectorAll(".select-note-icon").forEach((e=>{e.classList.remove("visible")})),Ie.selectedCount=0,Ie.selectedNotes.splice(0,Ie.selectedNotes.length)}async function Te(e){Ie.selectedNotes.forEach((async t=>{const n=t.closest(".box-note"),o=n.getAttribute("data-id");let i=await g();if(i){try{l(o,e,i)}catch(e){console.log("Error: ",e)}B(n)}}))}const Ie={selectedCount:0,selectedNotes:[],isNoteInputUnfolded:!1,isMenuOpen:!1,isSettingMenuOpen:!1,isNoteModificationMode:!1,isSettingWindowOpen:!1,offsetMenuWidth:80,currentNote:null,isOneNoteInRow:!1,isListItemsAddMode:!1};let Me={};function $e(e,t,n="",o={}){const i=document.createElement(e);return i.className=t,i.textContent=n,Object.entries(o).forEach((([e,t])=>{i.setAttribute(e,t)})),i}function Be(e,t,n){const o=document.createElement("i");return o.className=e,o.title=t,n&&o.addEventListener("click",n),o}function Pe(){const e=localStorage.getItem("displayMode")||"grid";localStorage.setItem("displayMode",e),"list"===e&&(Me.btnViewToggle.querySelector("i").className="fa-solid fa-table fa-lg",Me.btnViewToggle.title="Grid view")}function _e(){const e=localStorage.getItem("theme")||"light";localStorage.setItem("theme",e),function(e){const t="dark"===e;document.body.classList.toggle("dark-theme",t)}(e)}function Oe(){console.log("unfoldNoteInput"),Ie.isNoteInputUnfolded=!0,Me.inputTitleCreate.style.display="block",Me.btnSubmitCreate.style.display="block",Me.btnBackgroundCreate.style.display="block",Me.btnBackgroundCreate.style.fontSize="15px",Me.inputNoteCreate.style.fontSize="13px",Me.inputGroupCreate.style.flexDirection="column",Me.inputGroupCreate.style.alignItems="flex-start",Me.btnListCreate.style.fontSize="15px",Me.btnImageCreate.style.fontSize="15px",Me.actionsNoteCreate.style.width="100%",Me.formNoteCreate.classList.add("none"),Me.formNoteCreate.setAttribute("data-color","none"),Me.formNoteCreate.style.boxShadow="0 3px 5px rgba(0, 0, 0, 0.3), 0 -0.5px 1px rgba(0, 0, 0, 0.05), 2px 2px 2px rgba(0, 0, 0, 0.1), -2px 2px 2px rgba(0, 0, 0, 0.1)"}function He(){console.log("foldNoteInput"),Ie.isListItemsAddMode=!1,Ie.isNoteInputUnfolded=!1,Me.inputTitleCreate.value="",Me.inputTitleCreate.style.display="none",Me.inputNoteCreate.value="",Me.inputNoteCreate.removeAttribute("style"),Me.btnSubmitCreate.style.display="none",Me.btnBackgroundCreate.style.display="none",Me.inputGroupCreate.removeAttribute("style"),Me.btnListCreate.style.fontSize="20px",Me.btnImageCreate.style.fontSize="20px",Me.actionsNoteCreate.removeAttribute("style"),Me.formNoteCreate.classList.remove(Me.formNoteCreate.getAttribute("data-color")),Me.formNoteCreate.removeAttribute("data-color"),Me.formNoteCreate.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.2), 0 1px 2px rgba(0, 0, 0, 0.1), 0 -0.5px 1px rgba(0, 0, 0, 0.05)"}function je(e,t,n){console.log("updateContentUI: activeButton",e),function(e,t){t.forEach((t=>{t.classList.toggle("active",t===e),t.classList.toggle("inactive",t!==e)}))}(e,[Me.btnMenuArchive,Me.btnMenuTrash,Me.btnMenuNotes]),Fe(t,n),Ue()}async function De(){const e={"#archive":async()=>{je(Me.btnMenuArchive,"fa-solid fa-box","Your archived notes appear here");let e=await b();if(e)try{const t=await async function(e){return s({status:["archived"]},e)}(e);P(t)}catch(e){console.log("Error: ",e),$()}},"#trash":async()=>{je(Me.btnMenuTrash,"fa-regular fa-trash-can","No notes in Trash"),Me.messageTrash.style.display="flex";let e=await b();if(e)try{const t=await async function(e){return s({status:["deleted"]},e)}(e);P(t)}catch(e){console.log("Error: ",e),$()}},"#home":async()=>{je(Me.btnMenuNotes,"fa-regular fa-lightbulb","Notes you add appear here"),Me.noteCreate.style.display="block",Me.notesContainer.appendChild(Me.pinnedText),Me.notesContainer.appendChild(Me.othersText);let e=await b();if(e)try{const t=await async function(e){return s({status:["normal","pinned"]},e)}(e);P(t)}catch(e){console.log("Error: ",e),$()}},"#search":()=>{Ue(),Fe("","No matching results."),Me.notesContainer.appendChild(Me.pinnedText),Me.notesContainer.appendChild(Me.othersText)}},t=window.location.hash;e[t]?(e[t](),function(){const e=Me.headerSelection.querySelector(".select-toolbar");e.innerHTML="",function(e){const t=[{id:"btn-pin-selection",iconClass:"fa-thumbtack",label:"Pin",handler:ve},{id:"btn-background-selection",iconClass:"fa-palette",label:"Background options",handler:we}];return{"#home":[...t,{id:"btn-archive-selection",iconClass:"fa-box",label:"Archive",handler:Ee},{id:"btn-delete-selection",iconClass:"fa-trash",label:"Delete",handler:ke}],"#search":[...t,{id:"btn-archive-selection",iconClass:"fa-box",label:"Archive",handler:Ee},{id:"btn-delete-selection",iconClass:"fa-trash",label:"Delete",handler:ke}],"#archive":[...t,{id:"btn-unarchive-selection",iconClass:"fa-box-open",label:"Unarchive",handler:Se},{id:"btn-delete-selection",iconClass:"fa-trash",label:"Delete",handler:ke}],"#trash":[{id:"btn-delete-forever-selection",iconClass:"fa-trash",label:"Delete forever",handler:Le},{id:"btn-restore-selection",iconClass:"fa-trash-arrow-up",label:"Restore",handler:qe}]}[e]||[]}(window.location.hash).forEach((t=>{const n=function(e,t,n){const o=document.createElement("div");o.setAttribute("role","button"),o.className="btn-selection",o.id=`${e}`,o.title=n;const i=document.createElement("i");return i.className=`fa-solid ${t}`,o.appendChild(i),o}(t.id,t.iconClass,t.label);e.appendChild(n),n.addEventListener("click",t.handler)}))}()):window.location.hash="home"}function Fe(e,t){Me.iconNoContent.querySelector("i").className=e,Me.textNoContent.textContent=t}function Ue(){Me.messageNoContent.style.display="none",Me.noteCreate.style.display="none",Me.messageTrash.style.display="none",Me.btnEmptyTrash.style.display="none",Me.notesContainer.innerHTML="",Me.notesContainer.style.removeProperty("height")}document.addEventListener("DOMContentLoaded",(()=>{Me={btnClearSearch:document.getElementById("search-clear"),formSearch:document.getElementById("search-form"),searchContainer:document.querySelector(".search-input-wrapper"),btnClearSelection:document.getElementById("btn-clear-selection"),btnMenuToggle:document.getElementById("menu-toggle"),sidebarNav:document.querySelector(".sidebar-navigation"),sideBar:document.querySelector(".sidebar"),inputSearch:document.querySelector(".search-input"),btnEnterSearch:document.getElementById("search-enter"),btnViewToggle:document.getElementById("btn-view-toggle"),btnSettings:document.getElementById("btn-settings"),btnLogin:document.getElementById("btn-login"),userAccount:document.querySelector(".user-account"),textSelection:document.querySelector(".select-text"),notesCatalog:document.querySelector(".catalog"),pinnedText:document.getElementById("pinned-text"),othersText:document.getElementById("others-text"),imagesContainer:document.querySelector(".images-container"),overlay:document.querySelector(".overlay"),noteEditContainer:document.querySelector(".note-edit-container"),noteCreate:document.getElementById("create-note"),notesContainer:document.getElementById("notes-container"),messageNoContent:document.querySelector(".no-content-message"),messageTrash:document.querySelector(".trash-message"),iconNoContent:document.querySelector(".no-content-icon"),textNoContent:document.querySelector(".no-content-text"),btnEmptyTrash:document.querySelector(".btn-empty-trash"),btnMenuNotes:document.getElementById("btn-notes-menu"),btnMenuArchive:document.getElementById("btn-archive-menu"),btnMenuTrash:document.getElementById("btn-trash-menu"),headerSelection:document.querySelector(".selection-header"),inputTitleCreate:document.getElementById("title-input"),btnSubmitCreate:document.getElementById("btn-submit"),btnBackgroundCreate:document.getElementById("edit-background-color"),inputNoteCreate:document.getElementById("note-input"),inputGroupCreate:document.getElementById("input-group"),btnListCreate:document.getElementById("add-list-icon"),btnImageCreate:document.getElementById("add-image-note-icon"),actionsNoteCreate:document.getElementById("note-actions"),formNoteCreate:document.getElementById("note-form"),checkboxesContainer:document.getElementById("note-form").querySelector(".checkboxes-container")},Pe(),_e(),De(),W()}))})();